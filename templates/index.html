{% extends "layout.html" %}

{% block title %}
    Calendar
{% endblock %}

{% block main %}
    <div class="header">
        <form action="/prev/{{ current_year }}/{{ current_month }}" method="post">
            <button name="forwardBtn" title="Previous Month" type="submit">&lt;</button>
        </form>
        <form action="/next/{{ current_year }}/{{ current_month }}" method="post">
            <button name="backBtn" title="Next Month" type="submit">&gt;</button>
        </form>
        {% if todays_date.month != current_month or todays_date.year != current_year %}
            <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Back to current</a></li>
        {% endif %}
        <div class="current-date">
            {{ current_months_name }} {{ current_year }}
        </div>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('add_transaction') }}">Add Transaction</a></li>
     </div>

   <ul class="calendar-header">
        {% for weekday_header in weekdays_headers %}
            <li class="weekday-header">{{ weekday_header }}</li>
        {% endfor %}
    </ul>

    <ul class="calendar" id="calendar">
        {% for day in month_days %}
            <li
                {% if day.month != current_month %}
                    class="day othermonth"
                {% else %}
                    class="day"
                {% endif %}
                data-year="{{ day.year }}"
                data-month="{{ day.month }}"
                data-day="{{ day.day }}">

                {% if day.day == todays_date.day and day.month == todays_date.month and day.year == todays_date.year %}
                    <span class="daynumber-current">
                {% elif day.month != current_month %}
                    <span class="daynumber-othermonth">
                {% else %}
                    <span class="daynumber">
                {% endif %}
                {{ day.day }}</span>
<!--
                <form action="/add/{{ day.year }}/{{ day.month }}/{{ day.day }}" method="post">
                    <button class="hide" name="current" title="New Transaction" type="submit">+</button>
                </form>
-->
                <ul class="transactions">
                    {% if day.month|string in transactions and day.day|string in transactions[day.month|string] %}
                        {% for transaction in transactions[day.month|string][day.day|string]|sort(attribute="start_time") %}
                            <li
                                {% if day.month != month %}
                                    class="transaction greyed"
                                {% else %}
                                    class="transaction"
                                    style="background-color:{{ transaction["color"] }}"
                                {% endif %}
                                data-year="{{ day.year }}"
                                data-month="{{ day.month }}"
                                data-day="{{ day.day }}"
                                data-id="{{ transaction["id"] }}"
                                {% if "repetition_type" in transaction %}
                                    data-recurrent="1"
                                {% endif %}>
                                {{ transaction["title"] }}

                                <p class="accordion-hidden">
                                    {{ transaction["details"] }}
                                    {% if day.month == month %}
                                        <a href="#"
                                            data-id="{{ transaction["id"] }}"
                                            data-year="{{ day.year }}"
                                            data-month="{{ day.month }}"
                                            data-day="{{ day.day }}"
                                            data-title="{{ transaction["title"]|replace("\"","") }}"
                                            class="button smaller remove-transaction"
                                            title="Remove transaction">x</a>
                                        {% if "repetition_type" in transaction %}
                                            <a href="#"
                                                data-id="{{ transaction["id"] }}"
                                                data-year="{{ day.year }}"
                                                data-month="{{ day.month }}"
                                                data-day="{{ day.day }}"
                                                data-title="{{ transaction["title"]|replace("\"","") }}"
                                                class="button smaller hide-recurrent-transaction"
                                                title="Hide this transaction ocurrence">H</a>
                                        {% endif %}
                                            <a href="/{{ calendar_id }}/{{ day.year }}/{{ day.month }}/{{ day.day }}/{{ transaction["id"] }}{% if "repetition_type" in transaction %}?repeats=1{% endif %}"
                                                class="button smaller edit-transaction"
                                                title="Edit transaction">E</a>
                                    {% endif %}
                                    {% if "repetition_type" in transaction %}
                                        <span class="button smaller recurrent-transaction" title="Recurent Transaction">R</span>
                                    {% endif %}
                                </p>
                            </li>
                        {% endfor %}
                    {% endif %}
                </ul>

            </li>
        {% endfor %}
    </ul>
{% endblock %}
